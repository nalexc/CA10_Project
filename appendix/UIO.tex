\chapter{UIO}
\label{sec:UIO_deriv}


\tiny
\begin{align}
\begin{bmatrix}
\vec{_{lv}^s\dot{\omega}} \\
\vec{\dot{\omega}_{rw} } \\
\vec{\dot{q}_{1:3}}
\end{bmatrix} 
\nonumber
= \begin{bmatrix}
0 & 0 & \omega_o\frac{I_1 - I_2 + I_3}{-I_1} & 0 & 0 & \omega_o\frac{I_w}{-I_1} & 8\omega_o^2\frac{I_3 - I_2}{I_1} & 0 & 0 \\
0 & 0 &	0 & 0 & 0 &	0 & 0 &  6\omega_o^2\frac{I_3 - I_1}{I_2} & 0\\
\omega_o\frac{I_1 - I_2 + I_3}{I_3}  & 0 & 0 &  \omega_o\frac{I_w}{I_3} & 0 &	0 & 0 & 0 & 2\omega_o^2\frac{I_1 - I_2}{I_3}\\
0 & 0 &	0  & 0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 &	0  & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 &	0 & 0 & 0 & 0 & 0 & 0 & 0\\
0.5 & 0 &	0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0.5 &	0& 0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 &	0.5 & 0 & 0 & 0 & 0 & 0 & 0\\
\end{bmatrix}
\begin{bmatrix}
_{lv}^s\omega_1 \\
_{lv}^s\omega_2 \\
_{lv}^s\omega_3 \\
\omega_{rw,1} \\
\omega_{rw,2} \\
\omega_{rw,3} \\
q_1 \\
q_2 \\
q_3 
\end{bmatrix}
\\
\nonumber
+
\begin{bmatrix}
I_1^{-1} & 0 & 0 & 0 & \frac{b_3}{I_1} & -\frac{b_2}{I_1}	& I_1^{-1} & 0 & 0\\
0 & I_2^{-1} & 0 & - \frac{b_3}{I_2} & 0 &  \frac{b_1}{I_2} & 0 & I_2^{-1} & 0\\ 
0 & 0 & I_3^{-1} &  \frac{b_2}{I_3} &  -\frac{b_1}{I_3} & 0 & 0 & 0 & I_3^{-1} \\  
I_w^{-1} & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & I_w^{-1} & 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ 
0 & 0 & I_w^{-1} & 0 & 0 & 0 & 0 & 0 & 0\\  
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\\
\end{bmatrix}
\begin{bmatrix}
N_{rw,1} \\
N_{rw,2} \\
N_{rw,3}\\
\m_{mt,1} \\
\m_{mt,2} \\
\m_{mt,3} \\
N^{est}_{dist,1} \\
N^{est}_{dist,2} \\
N^{est}_{dist,3}
\end{bmatrix}
+
\begin{bmatrix}
I_1^{-1} & 0 & 0 \\
0 & I_2^{-1} & 0 \\
0 & 0 & I_3^{-1}\\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 
\end{bmatrix}
\begin{bmatrix}
N^{est \ error}_{dist,1} \\
N^{est \ error}_{dist,2} \\
N^{est \ error}_{dist,3}\\
\end{bmatrix}
\\
+ 
\begin{bmatrix}
I_1^{-1} & 0 & 0 & 0 & \frac{b_3}{I_1} & -\frac{b_2}{I_1}\\
0 & I_2^{-1} & 0 & - \frac{b_3}{I_2} & 0 &  \frac{b_1}{I_2} \\ 
0 & 0 & I_3^{-1} &  \frac{b_2}{I_3} &  -\frac{b_1}{I_3} & 0 \\  
I_w^{-1} & 0 & 0 & 0 & 0 & 0 \\
0 & I_w^{-1} & 0 & 0 & 0 & 0 \\ 
0 & 0 & I_w^{-1} & 0 & 0 & 0 \\  
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
\end{bmatrix}
\begin{bmatrix}
N^{fault}_{rw,1} \\
N^{fault}_{rw,2} \\
N^{fault}_{rw,3}\\
\m^{fault}_{mt,1} \\
\m^{fault}_{mt,2} \\
\m^{fault}_{mt,3} 
\end{bmatrix}
\label{eq:uioMatrices}
\end{align}
\normalsize

Modified equations for tetrahedral reaction wheel configuration and gravity gradient torque given as an input:

\begin{equation}
\vec{\dot{x}} =
\underline{A}\vec{x} + \underline{B}(t)\vec{u} + \underline{E} \vec{d} + \underline{F}_x \vec{f_y} 
\label{eq:uioagain}
\end{equation}

\begin{equation}
\vec{y} =
\underline{C}\vec{x} + \underline{F}_y \vec{f_y} 
\label{eq:uioagain2}
\end{equation}

\tiny
\begin{align}
\begin{bmatrix}
\vec{_{lv}^s\dot{\omega}} \\
\vec{\dot{\omega}_{rw} } \\
\vec{\dot{q}_{1:3}}
\end{bmatrix} 
\nonumber\\
= \begin{bmatrix}
0 & 0 & \omega_o\frac{I_1 - I_2 + I_3}{-I_1} & 0.58\omega_o\frac{I_w}{I_1} & 0.58\omega_o\frac{I_w}{I_1} & 0.58\omega_o\frac{I_w}{I_1} & -\omega_o\frac{I_w}{I_1} & 2\omega_o^2\frac{I_3 - I_2}{I_1} & 0 & 0 \\
0 & 0 &	0 & 0 & 0 &	0 & 0 &  0 &  0 & 0\\
\omega_o\frac{I_1 - I_2 + I_3}{I_3}  & 0 & 0 &  0.81\omega_o\frac{I_w}{I_3} & 0.77\omega_o\frac{I_w}{I_3} & 0.77\omega_o\frac{I_w}{I_3} &	0 & 0 & 0 & 2\omega_o^2\frac{I_1 - I_2}{I_3}\\
0 & 0 &	0  & 0 & 0 & 0 & 0 & 0 & 0& 0\\
0 & 0 &	0  & 0 & 0 & 0 & 0 & 0 & 0& 0 \\
0 & 0 &	0 & 0 & 0 & 0 & 0 & 0 & 0& 0\\
0 & 0 &	0 & 0 & 0 & 0 & 0 & 0 & 0& 0\\
0.5 & 0 &	0 & 0 & 0 & 0 & 0 & 0 & 0& 0 \\
0 & 0.5 &	0& 0 & 0 & 0 & 0 & 0 & 0& 0 \\
0 & 0 &	0.5 & 0 & 0 & 0 & 0 & 0 & 0& 0\\
\end{bmatrix}
\begin{bmatrix}
_{lv}^s\omega_1 \\
_{lv}^s\omega_2 \\
_{lv}^s\omega_3 \\
\omega_{rw,1} \\
\omega_{rw,2} \\
\omega_{rw,3} \\
\omega_{rw,4} \\
q_1 \\
q_2 \\
q_3 
\end{bmatrix}
\\
\nonumber
+
\begin{bmatrix}
0.81I_1^{-1} & 0.77I_1^{-1} & 0.77I_1^{-1} & 0 & 0 & \frac{b_3}{I_1} & -\frac{b_2}{I_1}	& I_1^{-1} & 0 & 0\\
0 & 0.125I_2^{-1} & -0.125I_2^{-1} & 0 & - \frac{b_3}{I_2} & 0 &  \frac{b_1}{I_2} & 0 & I_2^{-1} & 0\\ 
-0.58I_3^{-1} & -0.58 I_3^{-1} & -0.58 I_3^{-1} & I_3^{-1} &  \frac{b_2}{I_3} &  -\frac{b_1}{I_3} & 0 & 0 & 0 & I_3^{-1} \\  
I_w^{-1} & 0 & 0& 0 & 0 & 0 & 0 & 0 & 0 & 0 \\
0 & I_w^{-1} & 0& 0 & 0 & 0 & 0 & 0 & 0 & 0 \\ 
0 & 0 & I_w^{-1} & 0 & 0 & 0 & 0 & 0 & 0 & 0\\  
0 & 0 & 0 &  I_w^{-1} & 0& 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0& 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0& 0 & 0 & 0 & 0 & 0\\
0 & 0 & 0 & 0 & 0& 0 & 0 & 0 & 0 & 0
\end{bmatrix}
\begin{bmatrix}
N_{rw,1} \\
N_{rw,2} \\
N_{rw,3}\\
N_{rw,4}\\
\m_{mt,1} \\
\m_{mt,2} \\
\m_{mt,3} \\
N^{est}_{dist,1} \\
N^{est}_{dist,2} \\
N^{est}_{dist,3}
\end{bmatrix}
+
\\
\nonumber
\begin{bmatrix}
I_1^{-1} & 0 & 0 \\
0 & I_2^{-1} & 0 \\
0 & 0 & I_3^{-1}\\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 \\
0 & 0 & 0 
\end{bmatrix}
\begin{bmatrix}
N^{est \ error}_{dist,1} \\
N^{est \ error}_{dist,2} \\
N^{est \ error}_{dist,3}\\
\end{bmatrix}
\\
+ 
\begin{bmatrix}
0.81I_1^{-1} & 0.77I_1^{-1} & 0.77I_1^{-1} & 0 & 0 & \frac{b_3}{I_1} & -\frac{b_2}{I_1}\\
0 & 0.125I_2^{-1} & -0.125I_2^{-1} & 0 & - \frac{b_3}{I_2} & 0 &  \frac{b_1}{I_2} \\ 
-0.58I_3^{-1} & -0.58 I_3^{-1} & -0.58 I_3^{-1} & I_3^{-1} &  \frac{b_2}{I_3} &  -\frac{b_1}{I_3} & 0 \\  
I_w^{-1} & 0 & 0 & 0 & 0 & 0 \\
0 & I_w^{-1} & 0 & 0 & 0 & 0 \\ 
0 & 0 & I_w^{-1} & 0& 0 & 0 & 0 \\  
0 & 0 & 0 & I_w^{-1} & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0& 0 \\
0 & 0 & 0 & 0 & 0& 0 & 0 \\
\end{bmatrix}
\begin{bmatrix}
N^{fault}_{rw,1} \\
N^{fault}_{rw,2} \\
N^{fault}_{rw,3}\\
N^{fault}_{rw,4}\\
\m^{fault}_{mt,1} \\
\m^{fault}_{mt,2} \\
\m^{fault}_{mt,3} 
\end{bmatrix}
\label{eq:uioMatrices}
\end{align}
\normalsize

For more details please refer to \cite{DesatYang}.
